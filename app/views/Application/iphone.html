#{extends "iphone.html" /}
#{set title:"Capsula" /}

#{set 'moreStyles'}
<style type="text/css" media="screen">
    div#jqt ul li {
        background-color: #ffeab1;
        font-family: "Marker Felt";
        color: #000;
        border-top: 1px solid #a2a14d;
    }
    div#jqt ul li input[type="checkbox"] {
        background-color: #e8a322;
        border: 2px solid #e8a322;
    }
    div#jqt ul li input[type="text"], div#jqt ul li textarea {
        background-color: #ffeab1;
    }
    div#jqt textarea {
        background-color: #e8a322;
    }
    div#jqt .complete span {
        text-decoration: line-through;
    }
    div#jqt li small {
        opacity: 0;
        overflow: hidden;
        width: 0 !important;
        -webkit-transition: 250ms all ease-in-out;
    }
    div#jqt li.editingmode small {
        opacity: 1;
        width: 50% !important;
    }
    div#jqt .toolbar {
        background: url(data:image/gif;base64,R0lGODlhHQAsAMQAAFU9NUk0LYxkV2NGPX1ZTXJSRphtXoNeUWVIPk04MFxCOVE6MmpMQlpAOHVUSJ1wYmhLQG1ORFlAN1c/NnhXS2xOQkczLF5EO29QRWBEPE44MEo1LlI7M1A6Mkw3L2FFPCH5BAAAAAAALAAAAAAdACwAAAX/oPGMhkiaZXqiqSCU7vEabm3X8n3s/C70QBnwxyNQCAeCcqlMNp9GJPLoqC6thGrScaQ4pthuofCljKtVMuFsPFO8jnEBw3Vg7tw53nsn28d8GBERGGOCg4WDBYp6VYhch4h3GAwMhJQVBZURcYOMDJmglRWVlZSllRCFDBCmGBCtgqytqbC2graWsxG7r7awCBAREMGws7+wERXEwMXNwgjRzLbRCMvEwQzRAwMIrNze1d3a4K0I3aTd59Ln4+3B1e+s8dwDlfXg7fj69fz4HwAHEAP4IVrADwIHEESIAOGHCxcUOrzwAcLDiRgX1ssAMQNHbh25efzIMUO0DAoi/15QoMAjSwUNWX5g6XGlyZkZANZs0CDiAJ4KBlxoEHSAgp5Hgw5NuZLlUKIceRKFeJRoVYpJjzYl2kCCBAUzvTLtahVoVZZSvaolqlZCz7Ruj8YN63UCgLpuJQCYMKGr3a8K/kqY4NbvXr58AewdfBixXcR+EQ9OnPhwA7uKETe2jFlzZsx7FV9WDGA06dOiSTdQzIEogA6qVa+WDYADB9a3bXOQoHtBbt13e7fW3cG2htsdinNYkLx2cee6o79Obls5dQ7HOSjXrjt7dw0aaoPXDn78AvC+y2tYoPi4+vILzpdP4D4B/eXqbd/vYN+DhuQaeNCffxok4B92Av6XnIsHDHrQwXkMFhdghB00+J+BDNInYIUZNthgfxgOaCGEDW5g4gYPenCigxqY6J+LGG7g4AYBrnhiByfm+KKOJwaQo4wb+Ljjj/8FGcCQFrxowZE4LpljAD7+aAGNCQSw5JIqPonlBhZMGaSNWHoQpZVdmtilil1u2eWRKlopJJZpypgmg3GiWaaJY4YAADs=) top left repeat-x;
        border: 0;
        border-bottom: 1px solid #000;
    }
    #jqt  > .edgetoedge, #jqt > * {
        background: #ffeab1 none;
    }
    div#jqt .toolbar .btn2 {
        -webkit-border-radius: 5px;
        -webkit-border-image: none;
        display: block;
        background: rgba(40, 29, 25, .4) none !important;
        padding: 6px;
        border: 1px solid #372823;
        float: left;
        color: #fff;
        -webkit-box-shadow: rgba(255,255,255, .4) 0 1px 0;
        text-decoration: none;
        position: absolute;
        top: 5px;
        right: 10px;
        font-size: 13px;
        text-shadow: #000 0 -1px 0;
        display: inline;
    }
    div#jqt .btn2.active {
        background-color: rgba(0,0,0,.5);
    }
    div#jqt .edgetoedge h4 {
        border: 0;
        background: url(data:image/gif;base64,R0lGODlhHQAsAMQAAFU9NUk0LYxkV2NGPX1ZTXJSRphtXoNeUWVIPk04MFxCOVE6MmpMQlpAOHVUSJ1wYmhLQG1ORFlAN1c/NnhXS2xOQkczLF5EO29QRWBEPE44MEo1LlI7M1A6Mkw3L2FFPCH5BAAAAAAALAAAAAAdACwAAAX/oPGMhkiaZXqiqSCU7vEabm3X8n3s/C70QBnwxyNQCAeCcqlMNp9GJPLoqC6thGrScaQ4pthuofCljKtVMuFsPFO8jnEBw3Vg7tw53nsn28d8GBERGGOCg4WDBYp6VYhch4h3GAwMhJQVBZURcYOMDJmglRWVlZSllRCFDBCmGBCtgqytqbC2graWsxG7r7awCBAREMGws7+wERXEwMXNwgjRzLbRCMvEwQzRAwMIrNze1d3a4K0I3aTd59Ln4+3B1e+s8dwDlfXg7fj69fz4HwAHEAP4IVrADwIHEESIAOGHCxcUOrzwAcLDiRgX1ssAMQNHbh25efzIMUO0DAoi/15QoMAjSwUNWX5g6XGlyZkZANZs0CDiAJ4KBlxoEHSAgp5Hgw5NuZLlUKIceRKFeJRoVYpJjzYl2kCCBAUzvTLtahVoVZZSvaolqlZCz7Ruj8YN63UCgLpuJQCYMKGr3a8K/kqY4NbvXr58AewdfBixXcR+EQ9OnPhwA7uKETe2jFlzZsx7FV9WDGA06dOiSTdQzIEogA6qVa+WDYADB9a3bXOQoHtBbt13e7fW3cG2htsdinNYkLx2cee6o79Obls5dQ7HOSjXrjt7dw0aaoPXDn78AvC+y2tYoPi4+vILzpdP4D4B/eXqbd/vYN+DhuQaeNCffxok4B92Av6XnIsHDHrQwXkMFhdghB00+J+BDNInYIUZNthgfxgOaCGEDW5g4gYPenCigxqY6J+LGG7g4AYBrnhiByfm+KKOJwaQo4wb+Ljjj/8FGcCQFrxowZE4LpljAD7+aAGNCQSw5JIqPonlBhZMGaSNWHoQpZVdmtilil1u2eWRKlopJJZpypgmg3GiWaaJY4YAADs=) top left repeat-x;
        color: #ffeab1;
        border-bottom: 1px solid #9d7062;
        border-top: 1px solid #9d7062;
    }
</style>
#{/set}

#{set 'moreScripts'}
<script type="text/javascript" charset="utf-8">
    var jQT = $.jQTouch({
        icon: '',
	    startupScreen: '@{'/public/images/startup.png'}'
    });
    // Some sample Javascript functions:
    $(function(){
        function submitForm(){
            $el = $('#add form');
            var message = $('#message', $el).val();
            var when = $('#when', $el).val();
            if (message.length > 1 && when.length > 1) {
                $.post("@{Capsulas.create}", {message:message, when:when}, function(data) {
                	alert("Capsula sent!");
                });
	            jQT.goBack();
	            $el.get(0).reset();
	            return false;
            }
        }
        $('#add form').submit(submitForm);
        $('#add .whiteButton').click(submitForm);
        $('.complete li, .incomplete li').bind('swipe', function(){
           $(this).toggleClass('editingmode');
        });
        $('input[type="checkbox"]').live('change', function(){
            var $el = $(this);
            if ($el.attr('checked')) {
                $el.parent().prependTo('.complete');
            } else {
                $el.parent().appendTo('.incomplete');
            }
        });
    });
</script>
#{/set}
<div id="jqt">
    <div id="home" selected="true" class="edgetoedge form">
        <div class="toolbar">
            <h1>Capsula</h1>
            %{ if(controllers.Auth.isUserLoggedIn()) { }%
            	<a href="#add" class="btn2 slideup">Send new</a>
            %{ } else { }%
            	<a href="@{Auth.signInWithGoogle}" class="btn2" target="_webapp">Login</a>
            %{ } }%
        </div>
         %{ 
         	if(controllers.Auth.isUserLoggedIn()) {
         		def capsulas = controllers.Auth.getUser().getReceivedCapsulas() 
         }%
	        <h4>Received</h4>
		    <ul class="incomplete">
		    %{ if(capsulas.size > 0) { }%
	         	#{list items:capsulas, as:'capsula' }
			    	<li><span>${capsula.sendDate.format("MM-dd-yyyy")}</span> - ${capsula.message}</li>
	    		#{/list}
    		%{ } else { }%
				<li><span>You don't have capsulas.</span></li>
    		%{ } }%
		    </ul>
        %{ } else { }%
        	<h2>Send messages to the future!</h2> <h5>No need to register, just <a href="@{Auth.signInWithGoogle}" target="_webapp">use your google account</a>.</h5>
        %{ } }%
    </div>
    %{ if(controllers.Auth.isUserLoggedIn()) { }%
	    <div id="add" class="edit">
	        <form>
	            <div class="toolbar">
	                <h1>New Capsula</h1>
	                <a href="#" class="btn2 goback">Cancel</a>
	            </div>
	            <label for="message">Message</label>
	            <ul class="rounded">
	                <li><textarea id="message">${message}</textarea></li>
	            </ul>
	            <label for="message">When</label>
	            <ul class="rounded">
	                <li><input type="text" id="when" value="${models.Capsula.getDefaultDate().format("MM-dd-yyyy")}" /></li>
	            </ul>
	            <a href="#" class="whiteButton" style="margin: 10px">Send</a>
	        </form>
	    </div>
    %{ } }%
</div>