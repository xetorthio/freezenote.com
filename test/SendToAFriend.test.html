#{fixture delete:'all' /}

%{
	def today = new org.joda.time.DateTime()
	def date = today.plusMonths(1).toDate()
}%

#{selenium}
	clearSession()
	

	open('/fakeLogin?user=test@test.com')
    open('/capsulas/new')
    
    assertTitle('New Capsula')
    
    click('id=toAFriend')
    
    assertValue('id=when', ${date.format("MM-dd-yyyy HH:00 Z")})
    
    type('id=message', 'The owls are not what they seem')
    type('id=receiver', 'someone@test.com')
    
    clickAndWait('id=send')

    assertTitle('Capsula Sent')
    
    open('/capsulas/last')
    
    assertValue('id=message', 'The owls are not what they seem')
    assertValue('id=sender', 'test@test.com')
    assertValue('id=receiver', 'someone@test.com')
    assertValue('id=when', ${date.format("MM-dd-yyyy HH:00 Z")})
#{/selenium}